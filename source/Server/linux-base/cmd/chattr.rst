.. _chattr-cmd:

======================================================================================================================================================
chattr
======================================================================================================================================================



:Date: 2018-09

.. contents::


.. _chattr-format:

命令格式
======================================================================================================================================================

命令格式:
    chattr [-RVf] [-+=AacDdeijsSu] [-v version] files...


.. _chattr-user:

所属用户
======================================================================================================================================================

命令路径:
    /usr/bin/chattr
需要权限:
    普通用户权限即可执行


.. _chattr-guid:

使用指导
======================================================================================================================================================

改变linux文件的属性。

.. tip::
    一般可以通过这个命令对文件进行加锁防止文件修改。


.. _chattr-args:

参数
======================================================================================================================================================

**参数及参数作用：**

====================    =============================================================
**参数**                      **作用**
--------------------    -------------------------------------------------------------
-R                      递归处理，将指令目录下的所有文件及子目录一并处理；
--------------------    -------------------------------------------------------------
-v<版本编号>            设置文件或目录版本；
--------------------    -------------------------------------------------------------
-V                      显示指令执行过程；
--------------------    -------------------------------------------------------------
+<属性>                 开启文件或目录的该项属性；
--------------------    -------------------------------------------------------------
-<属性>                 关闭文件或目录的该项属性；
--------------------    -------------------------------------------------------------
=<属性>                 指定文件或目录的该项属性。
====================    =============================================================


可以设置的属性值及对应的含义：

=============   ====================================================================================================
**参数**                      **作用**
-------------   ----------------------------------------------------------------------------------------------------
+                在原有参数设定基础上，追加参数。
-------------   ----------------------------------------------------------------------------------------------------
-                在原有参数设定基础上，移除参数。
-------------   ----------------------------------------------------------------------------------------------------
=                更新为指定参数设定。
-------------   ----------------------------------------------------------------------------------------------------
A                文件或目录的 atime (access time)不可被修改(modified), 可以有效预防例如手提电脑磁盘I/O错误的发生。
-------------   ----------------------------------------------------------------------------------------------------
S                硬盘I/O同步选项，功能类似sync。
-------------   ----------------------------------------------------------------------------------------------------
a                即append，设定该参数后，只能向文件中添加数据，而不能删除，
                 多用于服务器日志文件安全，只有root才能设定这个属性。
-------------   ----------------------------------------------------------------------------------------------------
c                即compresse，设定文件是否经压缩后再存储。读取时需要经过自动解压操作。
-------------   ----------------------------------------------------------------------------------------------------
d                即no dump，设定文件不能成为dump程序的备份目标。
-------------   ----------------------------------------------------------------------------------------------------
i                设定文件不能被删除、改名、设定链接关系，同时不能写入或新增内容。i参数对于文件 系统的安全设置有很大帮助。
-------------   ----------------------------------------------------------------------------------------------------
j                即journal，设定此参数使得当通过mount参数data=ordered 或者 data=writeback 挂载的文件系统，
                 文件在写入时会先被记录(在journal中)。如果filesystem被设定参数为 data=journal，则该参数自动失效。
-------------   ----------------------------------------------------------------------------------------------------
s                保密性地删除文件或目录，即硬盘空间被全部收回。
-------------   ----------------------------------------------------------------------------------------------------
u                与s相反，当设定为u时，数据内容其实还存在磁盘中，可以用于undeletion。
=============   ====================================================================================================


.. attention::
    各参数选项中常用到的是a和i。

    - a选项强制只可添加不可删除，多用于日志系统的安全设定。
    - i是更为严格的安全设定，只有superuser (root) 或具有CAP_LINUX_IMMUTABLE处理能力（标识）的进程能够施加该选项。

.. _chattr-instance:

参考实例
======================================================================================================================================================

1. 为dns配置文件设置安全属性。
    
    文件不能被删除、改名、设定链接关系，同时不能写入或新增内容

.. code-block:: bash
    :linenos:

    [root@zzjlogin ~]# lsattr /etc/resolv.conf
    -------------e- /etc/resolv.conf
    [root@zzjlogin ~]# chattr +i /etc/resolv.conf
    [root@zzjlogin ~]# lsattr /etc/resolv.conf   
    ----i--------e- /etc/resolv.conf

2. 为日志文件设置安全属性，使日志只能追加，不可删除

.. code-block:: bash
    :linenos:
    
    [root@zzjlogin ~]# lsattr /var/log/messages
    -------------e- /var/log/messages
    [root@zzjlogin ~]# chattr +a /var/log/messages
    [root@zzjlogin ~]# lsattr /var/log/messages   
    -----a-------e- /var/log/messages

.. _chattr-relevant:

相关命令
======================================================================================================================================================

参考：
    :ref:`lsattr-cmd`

    :ref:`chmod-cmd`
    
    :ref:`stat-cmd`






