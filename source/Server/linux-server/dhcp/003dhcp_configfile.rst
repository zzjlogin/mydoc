
.. _dhcp-configfile:

======================================================================================================================================================
DHCP配置解析
======================================================================================================================================================

:Date: 2018-10

.. contents::


参考
======================================================================================================================================================

dhcp软件官方文档资料：https://kb.isc.org/docs/aa-00333



dhcp.conf文件解析
======================================================================================================================================================


配置文件规则：
    - 主配置文件dhcpd.conf中，包括声明、参数和选项3种基本类型
    - 具体配置内容用 ``{}`` 包裹；
    - 一般帮助理解配置格式：一行的结尾可以是以下三个字符中的任意一个或者空行：
        - {
        - }
        - ;
    - 大括号内一般每行一个配置项。( ``{}`` 可以继续嵌套子配置模块 ``{}`` )

具体配置项说明：


option domain-name-servers
    - 为客户机分配DNS解析域名时使用的DNS服务器地址。
    - 该配置项同样将体现在客户机的/etc/resolv.conf配置文件中（如“nameserver 202.106.0.20”）。
    - 若需要设置多个DNS服务器地址，可以使用逗号“,”进行分割。
    - 配置文件中默认设置如： ``option domain-name-servers ns1.example.org, ns2.example.org;`` 

option domain-name
    - 配置项用来为客户机指定解析主机名时的默认搜索域。
    - 该配置项将体现在客户机的“/etc/resolv.conf”配置文件中（如“search benet.com”）。
    - 配置文件中默认的搜索域是example.org，配置信息如： ``option domain-name "example.org";``

default-lease-time
    - 配置项用来设置默认租约时间，它的单位为秒。
    - 表示客户端可以从DHCP服务器租约某个IP地址的默认时间。默认配置如： ``default-lease-time 600;``
max-lease-time
    - 配置项用来配置允许DHCP客户端请求的最大租约时间。
    - 当客户端未请求明确的租约时间时，服务器将采用默认租约时间。默认配置如： ``max-lease-time 7200;``

ddns-update-style
    - 配置项用来设置与DHCP服务相关联的DNS数据动态更新模式。
    - 实际的DHCP应用中很少用的该参数，将值设为none即可。默认配置如下： ``ddns-update-style none;``

filename
    - 开始启动文件的名称，应用于无盘工作站，在kickstart自动化安装系统时需要使用这个参数。

next-server
    - 设置服务器从引导文件中装入主机名，应用于无盘工作站，在kickstart自动化安装系统时需要使用这个参数。

server-name
    - 通知DHCP客户服务器名称。
get-lease-hostnames flag
    - 检查客户端使用的IP地址。
hardware
    - 指定网卡接口类型和MAC地址。
fixed-address
    - 分配给客户端一个固定的地址。
authritative
    - 拒绝不正确的IP地址的要求。

host
    - 查看下面配置语法，指定IP和mac。配置静态IP。
    
参考配置语法：

.. code-block:: none
    :linenos:

    host 主机名 { 
        hardware ethernet 网卡的MAC地址; # 指定DHCP客户端网卡的MAC地址 
        fixed-address IP地址; # 指定为该DHCP客户端分配的IP地址 
        IP参数; # 指定默认网关等其他IP参数 
    }

常用声明关键字
------------------------------------------------------------------------------------------------------------------------------------------------------

====================== ========================================================
声 明                   解 释
---------------------- --------------------------------------------------------
shared-network          用来告知是否为一些子网络分享相同网络
---------------------- --------------------------------------------------------
subnet                  描述一个IP地址是否属于该子网
---------------------- --------------------------------------------------------
range                   用来提供动态分配IP地址的范围
---------------------- --------------------------------------------------------
host                    需要进行特别设置的主机，如为某个主机固定一个IP地址
---------------------- --------------------------------------------------------
group                   为一组参数提供声明
---------------------- --------------------------------------------------------
allow unknown-clients
---------------------- --------------------------------------------------------
deny unknown-client     是否动态分配IP给未知的使用者
---------------------- --------------------------------------------------------
allow bootp
---------------------- --------------------------------------------------------
deny bootp              是否响应激活查询
---------------------- --------------------------------------------------------
allow booting
---------------------- --------------------------------------------------------
deny booting            是否响应使用者查询
---------------------- --------------------------------------------------------
filename                开始启动文件的名称，应用于无盘工作站
---------------------- --------------------------------------------------------
next-server             设置服务器从引导文件中装入主机名，应用于无盘工作站
====================== ========================================================


参数
------------------------------------------------------------------------------------------------------------------------------------------------------

========================= ========================================================
参 数                       解 释
------------------------- --------------------------------------------------------
ddns-update-style           配置DHCP-DNS为互动更新模式
------------------------- --------------------------------------------------------
default-lease-time          指定默认租约时间的长度，单位为秒
------------------------- --------------------------------------------------------
max-lease-time              设置最大租约时间长度，单位为秒
------------------------- --------------------------------------------------------
hardware                    设置网卡接口类型和MAC地址
------------------------- --------------------------------------------------------
server-name                 告知DHCP客户服务器名称
------------------------- --------------------------------------------------------
get-lease-hostnames flag    检查客户端使用的IP地址
------------------------- --------------------------------------------------------
fixed-address ip            分配给客户端一个固定的IP地址
------------------------- --------------------------------------------------------
authritative                拒绝不正确的IP地址的要求
========================= ========================================================


选项
------------------------------------------------------------------------------------------------------------------------------------------------------

====================== ========================================================
选 项                   解 释
---------------------- --------------------------------------------------------
subnet-mask             为客户端设定子网掩码
---------------------- --------------------------------------------------------
domain-name             为客户端指明DNS名字
---------------------- --------------------------------------------------------
domain-name-servers     为客户端指明DNS服务器IP地址
---------------------- --------------------------------------------------------
host-name               为客户端指定主机名称
---------------------- --------------------------------------------------------
routers                 为客户端设定默认网关
---------------------- --------------------------------------------------------
broadcast-address       为客户端设定广播地址
---------------------- --------------------------------------------------------
ntp-server              为客户端设定网络时间服务器IP地址
---------------------- --------------------------------------------------------
time-offset             为客户端设定和格林威治时间的偏移时间，单位为秒
====================== ========================================================


dhcp.conf常用配置样例
======================================================================================================================================================
















