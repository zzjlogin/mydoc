.. _server-dns-bind-install:

======================================================================================================================================================
bind安装
======================================================================================================================================================

:Date: 2018-09

.. contents::



dns服务器环境
======================================================================================================================================================

=================== ==============================================================
系统版本                CentOS release 6.6 (Final)
------------------- --------------------------------------------------------------
主机名                  dns_01
------------------- --------------------------------------------------------------
硬件环境                x86_64
------------------- --------------------------------------------------------------
网络配置                eth0(dhcp)：192.168.161.137
------------------- --------------------------------------------------------------
bind软件                - bind-libs-9.8.2-0.68.rc1.el6_10.1.x86_64
                        - bind-utils-9.8.2-0.68.rc1.el6_10.1.x86_64
                        - bind-9.8.2-0.68.rc1.el6_10.1.x86_64
                        - bind-chroot-9.8.2-0.68.rc1.el6_10.1.x86_64
                        - bind-devel-9.8.2-0.68.rc1.el6_10.1.x86_64
=================== ==============================================================

.. tip::
    - 系统是最小化安装。然后勾选了 ``Debugging Tools`` 和 ``Development tools``
    - bind-libs和bind-utils系统默认已经安装。


bind软件包说明：
    - bind-libs-9.8.2-0.68.rc1.el6_10.1.x86_64
        bind所有程序使用到的库文件，系统默认已经安装
    - bind-utils-9.8.2-0.68.rc1.el6_10.1.x86_64
        bind提供的相关工具包，系统默认已经安装
    - bind-9.8.2-0.68.rc1.el6_10.1.x86_64
        bind服务器端主程序，需要安装。
    - bind-chroot-9.8.2-0.68.rc1.el6_10.1.x86_64
        bind相关安全相关的服务。需要安装。(一些资料说不用安装，不安装不影响使用，但是生产环境考虑到安全因素一般都安装)
    - bind-devel-9.8.2-0.68.rc1.el6_10.1.x86_64
        bind二次开发使用的环境，一般也安装。

bind安装环境准备
======================================================================================================================================================

网络时间同步
------------------------------------------------------------------------------------------------------------------------------------------------------

.. attention::
    如果时间没有和网络同步，yum安装会报错。
    
    参考:
        :ref:`linux-yuminstallerr-time`

.. code-block:: bash
    :linenos:

    [root@dns_01 ~]# date
    Thu Sep  6 21:07:25 CST 2018
    [root@dns_01 ~]# ntpdate pool.ntp.org
    28 Sep 00:53:38 ntpdate[1577]: step time server 5.103.139.163 offset 1827966.915121 sec



关闭selinux
------------------------------------------------------------------------------------------------------------------------------------------------------

.. note::
    如果不关闭selinux也没有配置selinux。则安装以后zabbix会启动失败。会发现zabbix网页可以访问，但是提示zabbix服务没有启动。

**永久关闭:**
    下面配置会让selinux的关闭重启系统后还是关闭状态。但是配置不会立即生效。

.. note::
    通过 ``source /etc/selinux/config`` 也不能让修改的文件立即生效。所以需要下面的临时关闭的方式结合使用。

.. code-block:: bash
    :linenos:

    [root@dns_01 ~]# sed -i 's/SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config
    [root@dns_01 ~]# grep SELINUX /etc/selinux/config
    # SELINUX= can take one of these three values:
    SELINUX=disabled
    # SELINUXTYPE= can take one of these two values:
    SELINUXTYPE=targeted

**临时关闭：**
    下面配置是立即生效，但是系统重启后会失效。

.. code-block:: bash
    :linenos:

    [root@dns_01 ~]# getenforce
    Enforcing
    [root@dns_01 ~]# setenforce 0
    [root@dns_01 ~]# getenforce
    Permissive




关闭防火墙
------------------------------------------------------------------------------------------------------------------------------------------------------

.. note::
    防火墙一般都是关闭。如果不不关闭，也可以通过配置规则允许所有使用的端口被访问。

.. code-block:: bash
    :linenos:

    [root@dns_01 ~]# /etc/init.d/iptables stop 
    iptables: Setting chains to policy ACCEPT: filter          [  OK  ]
    iptables: Flushing firewall rules:                         [  OK  ]
    iptables: Unloading modules:                               [  OK  ]

关闭防火墙开机自启动

.. code-block:: bash
    :linenos:
    
    [root@dns_01 ~]# chkconfig iptables off


系统准备命令集合
------------------------------------------------------------------------------------------------------------------------------------------------------

.. code-block:: bash
    :linenos:

    ntpdate pool.ntp.org
    sed -i 's/SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config
    setenforce 0
    /etc/init.d/iptables stop 
    chkconfig iptables off




bind安装
======================================================================================================================================================


安装前软件包检查

.. code-block:: bash
    :linenos:

    [root@dns_01 ~]# rpm -qa bind*
    bind-utils-9.8.2-0.30.rc1.el6.x86_64
    bind-libs-9.8.2-0.30.rc1.el6.x86_64

安装相关软件包：

.. code-block:: bash
    :linenos:

    [root@dns_01 ~]# yum install bind bind-chroot bind-devel -y

检查安装情况：

.. code-block:: bash
    :linenos:

    [root@dns_01 ~]# rpm -qa bind*
    bind-devel-9.8.2-0.68.rc1.el6_10.1.x86_64
    bind-libs-9.8.2-0.68.rc1.el6_10.1.x86_64
    bind-9.8.2-0.68.rc1.el6_10.1.x86_64
    bind-utils-9.8.2-0.68.rc1.el6_10.1.x86_64
    bind-chroot-9.8.2-0.68.rc1.el6_10.1.x86_64


bind所有程序目录
======================================================================================================================================================


查看bind主程序安装目录
------------------------------------------------------------------------------------------------------------------------------------------------------

.. code-block:: bash
    :linenos:

    [root@dns_01 ~]# rpm -qa bind
    bind-9.8.2-0.68.rc1.el6_10.1.x86_64
    [root@dns_01 ~]# rpm -ql bind
    /etc/NetworkManager/dispatcher.d/13-named
    /etc/logrotate.d/named
    /etc/named
    /etc/named.conf
    /etc/named.iscdlv.key
    /etc/named.rfc1912.zones
    /etc/named.root.key
    略
    /var/log/named.log
    /var/named
    /var/named/data
    /var/named/dynamic
    /var/named/named.ca
    /var/named/named.empty
    /var/named/named.localhost
    /var/named/named.loopback
    /var/named/slaves
    /var/run/named

bind主要目录说明
------------------------------------------------------------------------------------------------------------------------------------------------------

bind配置文件目录
    /etc/

==============================  ==============================================
目录/文件                           说明
------------------------------  ----------------------------------------------
/etc/named                      存放子配置文件，默认是空目录
------------------------------  ----------------------------------------------    
/etc/named.conf                 主配置文件
------------------------------  ----------------------------------------------
/etc/named.iscdlv.key
------------------------------  ----------------------------------------------
/etc/named.rfc1912.zones
------------------------------  ----------------------------------------------
/etc/named.root.key
------------------------------  ----------------------------------------------
/etc/sysconfig/named
------------------------------  ----------------------------------------------
/usr/lib64/bind
------------------------------  ----------------------------------------------
/etc/portreserve/named
==============================  ==============================================

bind启动脚本
    /etc/rc.d/init.d/named

bind域名配置目录
    /var/named/

bind软件包提供的命令目录：
    /usr/sbin/

==============================  ==============================================
/usr/sbin/arpaname
------------------------------  ----------------------------------------------
/usr/sbin/named                     bind主程序
------------------------------  ----------------------------------------------
/usr/sbin/named-checkconf           检查bind配置文件命令
------------------------------  ----------------------------------------------
/usr/sbin/named-checkzone           检查配置的zone区域命令
------------------------------  ----------------------------------------------
/usr/sbin/named-compilezone
------------------------------  ----------------------------------------------
/usr/sbin/named-journalprint
==============================  ==============================================


bind相关模版和文档
    /usr/share/doc/bind-9.8.2/

bind相关的man帮助
    /usr/share/man/man5/named.conf.5.gz



bind启动/开机自启动
======================================================================================================================================================

启动bind：

.. code-block:: bash
    :linenos:

    [root@dns_01 etc]# cd /var && chown -R named.named named/

    [root@dns_01 var]# /etc/init.d/named start
    chkconfig named on
    Starting named: named: already running                     [  OK  ]
    
开机启动

.. code-block:: bash
    :linenos:

    [root@dns_01 var]# chkconfig named on


添加配置后重新加载配置

.. code-block:: bash
    :linenos:

    [root@dns_01 etc]# rndc reload


